<!DOCTYPE html>	
<html lang="pt">
	<head>
		<meta charset="utf-8">
		<title>Administração</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link href="/library/css/bootstrap.min.css" rel="stylesheet" media="screen">
		<link href="/library/css/bootstrap-responsive.min.css" rel="stylesheet">
		<link href="/library/css/admin.css" rel="stylesheet">
 	</head>
 	<body>
 	
		<div id="menu"></div>
 		
		<div class="container">
			<ul class="breadcrumb">
				<li>Resumo <span class="divider">/</span></li>
				<li>Produtos <span class="divider">/</span></li>
				<li class="active">Alterar</li>
			</ul>
			
			<form id="form" class="form-horizontal" style="display: block">
				<div class="control-group">
					<label class="control-label">Imagens: <span class="help-block">Click nas imagens ao lado para substituir por imagens que represente o produto.</span><span id="spanError-images" class="help-inline"></span></label>
					<div class="controls" id="imagesDivUpload"></div>
				</div>
				<div class="control-group">
					<label class="control-label">Nome:</label>
					<div class="controls">
						<input name="name" type="text" class="input-block-level" placeholder="Nome do produto…" maxlength="45">
						<span id="spanError-name" class="help-inline"></span>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">Categorias: <span class="help-block">Click no botão "Adicionar" para atribuir categorias ao produto.</span><span id="spanError-category" class="help-inline"></span></label>
					<div class="controls">
						<select id="comboCategory" class="span3"></select><button class="btn" type="button" onclick="addCategory()">Adicionar</button>
						<div id="selectedsCategory"></div>
						<input type="hidden" name="category" value="" id="category">
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">Introdução:</label>
					<div class="controls">
						<input name="introduction" type="text" class="input-block-level" placeholder="Introdução do produto…" maxlength="255">
						<span id="spanError-introduction" class="help-inline"></span>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">Descrição:</label>
					<div class="controls">
						<textarea name="description" class="input-block-level" placeholder="Descrição da categoria…"></textarea>
						<span id="spanError-description" class="help-inline"></span>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">Quantidade:</label>
					<div class="controls">
						<input name="quantity" type="text" class="span3" placeholder="Quantidade…">
						<span id="spanError-quantity" class="help-inline"></span>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">Quantidade por frete: <span class="help-block">Quantidade de produtos para cada frete cobrado (Exemplo: 1 frete = 10 produtos)</span></label>
					<div class="controls">
						<input name="quantityFrete" type="text" class="span3" placeholder="Quantidade…">
						<span id="spanError-quantityFrete" class="help-inline"></span>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">Valor:</label>
					<div class="controls">
						<input name="unityvalue" type="text" class="span3" placeholder="Valor unitário…">
						<span id="spanError-unityvalue" class="help-inline"></span>
					</div>
				</div>
				<input type="hidden" name="images" value="" id="imagesForm">
				<input type="hidden" name="id" value="">
				<div class="control-group">
					<div class="controls">
						<button type="button" class="btn btn-primary" onclick="preencheTextArea();postJson('editForm', '/ecommerce-web/admin/product/insert', $('form#form').serialize());">Salvar</button>
						<button type="reset" class="btn" onclick="preencheImages();limpaTA();">Limpar</button>
					</div>
				</div>
			</form>
		</div>
 		
 		<div id="footer"></div>
 	
 		<div style="display: none;">
 			<form action="/ecommerce-web/admin/product/upload" id="form_upload" enctype="multipart/form-data" method="post">
 				<input type="file" name="uploadFile" id="uploadFile" accept="image/*">
 				<input type="hidden" name="positionFile" id="positionFile">
 				<input type="button" id="alertError" onclick="alert(this.value, false)">
 			</form>
 			<div id="upload_target"></div>
 		</div>
   
 	 	<script src="/library/js/jquery-1.8.3.min.js"></script>
		<script src="/library/js/bootstrap.min.js"></script>

		<script src="/library/js/functions.js" charset="utf-8"></script>
		<script src="/library/js/admin.js" charset="utf-8"></script>
		<script src="/library/js/jquery.maskmoney.min.js"></script>
		<script src="/library/js/jquery.maskedinput-1.3.min.js"></script>
		<script type="text/javascript" src="http://js.nicedit.com/nicEdit-latest.js"></script>
		<script src="/library/js/uploadAdmin.js"></script>
		<script src="/library/js/jquery.form.js"></script>

		<script>
			loadMenuEcommerce();
			loadFooter();
			bkLib.onDomLoaded(function() { nicEditors.allTextAreas() });
			
			function callback(id, data) {
				if (data.status) {
					if (id=='editForm') {
						
						alert("Produto alterado com sucesso.", true);
						location.href='../consult';
						preencheImages();
					
					} else if (id=='preencheCbCategory') {
						
						var opt = '';
						$.each(data.generic, function(key, val) {
							opt += '<option value="'+val.id+'">'+val.name+'</option>';
						});
						$('select#comboCategory').html(opt);
						
					}
				} else {
					errorForm(data, '/ecommerce');
				}
			}
			
			function callback2(id, data) {
				if (data.status) {
					$('#imagesDivUpload').html(getSequenceImages(data.generic.images, '128', '131', true));
					$('#imagesForm').val(data.generic.images);
					$('input[name="name"]').val(data.generic.name);
					$('input[name="introduction"]').val(data.generic.introduction);
					$('div.nicEdit-main').html(data.generic.description);
					$('input[name="quantity"]').val(data.generic.quantity);
					$('input[name="quantityFrete"]').val(data.generic.quantityFrete);
					$('input[name="unityvalue"]').val(data.generic.unityvalue);
					$('input[name="id"]').val(data.generic.id);
					preencheInitCategory(data.genericList);
					//$('textarea[name="description"]').val(data.generic.description);
				} else {
					errorForm(data, '/ecommerce');
				}
			}
			
			function upload(position) {
				$('img#iposition'+position).attr('src', '/library/img/imgfotoLoading.png');
				$('input#positionFile').val(position);
				$('input#uploadFile').click();
			}
			
			function preencheImages() {
				var html = 	'<a href="#" onclick="upload(\'1\');"><img id="iposition1" src="/library/img/imgfoto.png" class="img-rounded" width="128" height="131"></a>';
				html +=		'<a href="#" onclick="upload(\'2\');"><img id="iposition2" src="/library/img/imgfoto.png" class="img-rounded" width="128" height="131"></a>';
				html +=		'<a href="#" onclick="upload(\'3\');"><img id="iposition3" src="/library/img/imgfoto.png" class="img-rounded" width="128" height="131"></a>';
				html +=		'<a href="#" onclick="upload(\'4\');"><img id="iposition4" src="/library/img/imgfoto.png" class="img-rounded" width="128" height="131"></a>';
				html +=		'<a href="#" onclick="upload(\'5\');"><img id="iposition5" src="/library/img/imgfoto.png" class="img-rounded" width="128" height="131"></a>';
				html +=		'<a href="#" onclick="upload(\'6\');"><img id="iposition6" src="/library/img/imgfoto.png" class="img-rounded" width="128" height="131"></a>';
				$('#imagesDivUpload').html(html);
			}
			
			getJson2('', '/ecommerce-web/admin/product/load?id='+getURLParameter('pid'));
			
			$("input[name='quantity']").mask("9?999");
			$("input[name='unityvalue']").maskMoney({symbol:'R$ ', showSymbol:true, thousands:'.', decimal:',', symbolStay: false});
			
			function preencheInitCategory(dataList) {
				$.each(dataList, function(key, val) {
					genericAddCategory(val.category.name, val.category.id);
				});
			}
			
			getJson('preencheCbCategory', '/ecommerce-web/admin/product/category/list');
			
			$('#uploadFile').live('change', function(){
				//$('#visualizar').html('<img src="ajax-loader.gif" alt="Enviando..."/> Enviando...');
				$('#form_upload').ajaxForm({
					dataType: 'script',
					target:'#upload_target'
				}).submit();
		     });
		</script>
 	</body>
 </html>