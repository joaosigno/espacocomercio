(function(a){a.fn.maskMoney=function(b){b=a.extend({symbol:"US$",showSymbol:false,symbolStay:false,thousands:",",decimal:".",precision:2,defaultZero:true,allowZero:false,allowNegative:false},b);
return this.each(function(){var m=a(this);
var d=false;
function o(){d=true
}function j(){d=false
}function q(y){y=y||window.event;
var s=y.charCode||y.keyCode||y.which;
if(s==undefined){return false
}if(m.attr("readonly")&&(s!=13&&s!=9)){return false
}if(s<48||s>57){if(s==45){o();
m.val(f(m));
return false
}else{if(s==43){o();
m.val(m.val().replace("-",""));
return false
}else{if(s==13||s==9){if(d){j();
a(this).change()
}return true
}else{if(s==37||s==39){return true
}else{l(y);
return true
}}}}}else{if(m.val().length>=m.attr("maxlength")){return false
}else{l(y);
var v=String.fromCharCode(s);
var r=m.get(0);
var w=m.getInputSelection(r);
var u=w.start;
var t=w.end;
r.value=r.value.substring(0,u)+v+r.value.substring(t,r.value.length);
e(r,u+1);
o();
return false
}}}function k(w){w=w||window.event;
var s=w.charCode||w.keyCode||w.which;
if(s==undefined){return false
}if(m.attr("readonly")&&(s!=13&&s!=9)){return false
}var r=m.get(0);
var v=m.getInputSelection(r);
var u=v.start;
var t=v.end;
if(s==8){l(w);
if(u==t){r.value=r.value.substring(0,u-1)+r.value.substring(t,r.value.length);
u=u-1
}else{r.value=r.value.substring(0,u)+r.value.substring(t,r.value.length)
}e(r,u);
o();
return false
}else{if(s==9){if(d){a(this).change();
j()
}return true
}else{if(s==46||s==63272){l(w);
if(r.selectionStart==r.selectionEnd){r.value=r.value.substring(0,u)+r.value.substring(t+1,r.value.length)
}else{r.value=r.value.substring(0,u)+r.value.substring(t,r.value.length)
}e(r,u);
o();
return false
}else{return true
}}}}function n(t){var r=p();
if(m.val()==r){m.val("")
}else{if(m.val()==""&&b.defaultZero){m.val(c(r))
}else{m.val(c(m.val()))
}}if(this.createTextRange){var s=this.createTextRange();
s.collapse(false);
s.select()
}}function i(r){if(a.browser.msie){q(r)
}if(m.val()==""||m.val()==c(p())||m.val()==b.symbol){if(!b.allowZero){m.val("")
}else{if(!b.symbolStay){m.val(p())
}else{m.val(c(p()))
}}}else{if(!b.symbolStay){m.val(m.val().replace(b.symbol,""))
}else{if(b.symbolStay&&m.val()==b.symbol){m.val(c(p()))
}}}}function l(r){if(r.preventDefault){r.preventDefault()
}else{r.returnValue=false
}}function e(r,t){var s=m.val().length;
m.val(h(r.value));
var u=m.val().length;
t=t-(s-u);
m.setCursorPosition(t)
}function h(B){B=B.replace(b.symbol,"");
var r="0123456789";
var y=B.length;
var A="",C="",w="";
if(y!=0&&B.charAt(0)=="-"){B=B.replace("-","");
if(b.allowNegative){w="-"
}}if(y==0){if(!b.defaultZero){return C
}C="0.00"
}for(var x=0;
x<y;
x++){if((B.charAt(x)!="0")&&(B.charAt(x)!=b.decimal)){break
}}for(;
x<y;
x++){if(r.indexOf(B.charAt(x))!=-1){A+=B.charAt(x)
}}var u=parseFloat(A);
u=isNaN(u)?0:u/Math.pow(10,b.precision);
C=u.toFixed(b.precision);
x=b.precision==0?0:1;
var s,z=(C=C.split("."))[x].substr(0,b.precision);
for(s=(C=C[0]).length;
(s-=3)>=1;
){C=C.substr(0,s)+b.thousands+C.substr(s)
}return(b.precision>0)?c(w+C+b.decimal+z+Array((b.precision+1)-z.length).join(0)):c(w+C)
}function g(){var r=m.val();
m.val(h(r))
}function p(){var r=parseFloat("0")/Math.pow(10,b.precision);
return(r.toFixed(b.precision)).replace(new RegExp("\\.","g"),b.decimal)
}function c(r){if(b.showSymbol){if(r.substr(0,b.symbol.length)!=b.symbol){return b.symbol+r
}}return r
}function f(s){if(b.allowNegative){var r=s.val();
if(s.val()!=""&&s.val().charAt(0)=="-"){return s.val().replace("-","")
}else{return"-"+s.val()
}}else{return s.val()
}}m.bind("keypress.maskMoney",q);
m.bind("keydown.maskMoney",k);
m.bind("blur.maskMoney",i);
m.bind("focus.maskMoney",n);
m.bind("mask",g);
m.one("unmaskMoney",function(){m.unbind(".maskMoney");
if(a.browser.msie){this.onpaste=null
}else{if(a.browser.mozilla){this.removeEventListener("input",i,false)
}}})
})
};
a.fn.unmaskMoney=function(){return this.trigger("unmaskMoney")
};
a.fn.mask=function(){return this.trigger("mask")
};
a.fn.setCursorPosition=function(b){this.each(function(d,e){if(e.setSelectionRange){e.focus();
e.setSelectionRange(b,b)
}else{if(e.createTextRange){var c=e.createTextRange();
c.collapse(true);
c.moveEnd("character",b);
c.moveStart("character",b);
c.select()
}}});
return this
};
a.fn.getInputSelection=function(f){var i=0,d=0,h,e,c,b,g;
if(typeof f.selectionStart=="number"&&typeof f.selectionEnd=="number"){i=f.selectionStart;
d=f.selectionEnd
}else{e=document.selection.createRange();
if(e&&e.parentElement()==f){b=f.value.length;
h=f.value.replace(/\r\n/g,"\n");
c=f.createTextRange();
c.moveToBookmark(e.getBookmark());
g=f.createTextRange();
g.collapse(false);
if(c.compareEndPoints("StartToEnd",g)>-1){i=d=b
}else{i=-c.moveStart("character",-b);
i+=h.slice(0,i).split("\n").length-1;
if(c.compareEndPoints("EndToEnd",g)>-1){d=b
}else{d=-c.moveEnd("character",-b);
d+=h.slice(0,d).split("\n").length-1
}}}}return{start:i,end:d}
}
})(jQuery);