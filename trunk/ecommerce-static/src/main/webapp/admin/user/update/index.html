<!DOCTYPE html>	
<html lang="pt">
	<head>
		<meta charset="utf-8">
		<title>Administração</title>
		<link href="/library/css/bootstrap.min.css" rel="stylesheet" media="screen">
		<link href="/library/css/bootstrap-responsive.min.css" rel="stylesheet">
		<link href="/library/css/admin.css" rel="stylesheet">
 	</head>
 	<body>
 	
		<div id="menu"></div>
 		
		<div class="container">
			<ul class="breadcrumb">
				<li>Resumo <span class="divider">/</span></li>
				<li>E-commerce <span class="divider">/</span></li>
				<li>Usuários <span class="divider">/</span></li>
				<li class="active">Alterar</li>
			</ul>
			
			<form class="form-horizontal" style="display: block">
				<div class="control-group">
					<label class="control-label">Usuário: <span class="help-block">Digite um e-mail válido para acesso ao sistema.</span></label>
					<div class="controls">
						<input name="user" type="text" class="input-block-level" placeholder="Digite um e-mail válido…" maxlength="100">
						<span id="spanError-user" class="help-inline"></span>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">Senha: <span class="help-block"><input type="checkbox" onclick="alterPassword()"> Alterar senha</span></label>
					<div class="controls">
						<input name="password" type="password" class="span3" placeholder="Senha…" maxlength="10" disabled>
						<input name="passwordConfirm" type="password" class="span3" placeholder="Confirmar…" maxlength="10" disabled>
						<span id="spanError-password" class="help-inline"></span>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">Categoria: <span class="help-block">A categoria determina quais permissões o usuário terá no sistema.</span></label>
					<div class="controls">
						<select name="permission"></select>
						<span id="spanError-permission" class="help-inline"></span>
					</div>
				</div>
				<div class="control-group">
					<div class="controls">
						<input type="hidden" name="id">
						<button type="button" class="btn btn-primary" onclick="submitForm();">Salvar</button>
					</div>
				</div>
			</form>
		</div>
 		
 		<div id="footer"></div>
 	
   
 	 	<script src="/library/js/jquery-1.8.3.min.js"></script>
		<script src="/library/js/bootstrap.min.js"></script>

		<script src="/library/js/functions.js" charset="utf-8"></script>
		<script src="/library/js/admin.js" charset="utf-8"></script>

		<script>
			loadMenuEcommerce();
			loadFooter();
			
			function callback(id, data) {
				if (data.status) {
					if (id=='update') {
						location.href='../manage';
					} else if (id == 'load') {
						preenchePermission();
						$('input[name=user]').val(data.generic.user);
						$('select[name=permission]').val(data.generic.permission);
						$('input[name=id]').val(data.generic.id);
					}
					
				} else {
					errorForm(data, '/ecommerce');
				}
			}
			
			function preenchePermission() {
				var html = '';
				for (var i=1; i<=10; i++) {
					if (getLblPermissions(i)!='') {
						html += '<option value="'+i.toString()+'">'+getLblPermissions(i)+'</option>';
					}
				}
				
				$('select[name="permission"]').html(html);
			}
			
			function submitForm() {
				if ($('input[type="checkbox"]').is(':checked')) {
					var pass = $('input[name=password]').val();
					var passConf = $('input[name=passwordConfirm]').val();
					if (pass!='' && pass==passConf) {
						postJson('update', '/ecommerce-web/admin/user/save', $('form').serialize());
					} else {
						$('[name="password"]').parent().parent().attr('class', $('[name="password"]').parent().parent().attr('class')+" error");
						$('#spanError-password').text('As senhas digitadas estão diferentes ou são inválidas.');
					}
				} else {
					postJson('update', '/ecommerce-web/admin/user/save', $('form').serialize());
				}
			}
			
			function alterPassword() {
				$("input[type=password]").val('');
				if ($('input[type="checkbox"]').is(':checked')) {
					$("input[type=password]").attr("disabled",false);
				} else {
					$("input[type=password]").attr("disabled",true);
				}
			}
			
			getJson('load', '/ecommerce-web/admin/user/load?id='+getURLParameter('pid'), true);
		</script>
 	</body>
 </html>